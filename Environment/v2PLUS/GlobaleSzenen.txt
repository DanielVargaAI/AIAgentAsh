import type { BattleScene } from "#app/battle-scene";

export let globalScene: BattleScene;

export function initGlobalScene(scene: BattleScene): void {
  globalScene = scene;
  window.globalScene = globalScene;

  function serializePartyPokemon(p) {
  return {
    formIndex: p.formIndex,
    dex_nr: p.species?.speciesId,
    hp: p.hp,
    stats: p.stats,
    visible: p._visible,
    moveset: p.moveset?.map(m => ({
      id: m.moveId,
    })),
  };
}

  function serializeEnemyPokemon(p) {
  return {
    formIndex: p.formIndex,
    dex_nr: p.species?.speciesId,
    hp: p.hp,
    stats: p.stats,
  };
}


globalThis.__GLOBAL_SCENE_DATA__ = () => ({
  player: scene.party.map(serializePartyPokemon),
  enemy: scene.currentBattle.enemyParty.map(serializeEnemyPokemon),
  phase: scene.phaseManager.currentPhase.phaseName,

  // only select typeoptions when phase = SelectModifierPhase

  shopitems: scene.phaseManager.getCurrentPhase.typeOptions?.map(option => ({
    id: option.type.id,
    tier: option.type.tier,
  
  }))
 });

}